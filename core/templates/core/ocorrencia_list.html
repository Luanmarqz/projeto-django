{% load django_bootstrap5 %} {% load static %} {% bootstrap_css %}

<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OcorrenciasIFRN</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'core/css/style.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">OcorrênciasIF</a>
        <button
          class="navbar-toggler d-md-none"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="offcanvas offcanvas-end text-bg-dark"
          tabindex="-1"
          id="offcanvasNavbar"
        >
          <div class="offcanvas-header">
            <h5 class="offcanvas-title">Menu</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="offcanvas"
            ></button>
          </div>
          <div class="offcanvas-body">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="#">Página Inicial</a>
              </li>
              <li class="nav-item"><a class="nav-link" href="#">Sobre</a></li>
              <li class="nav-item"><a class="nav-link" href="#">Contato</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="sidebar d-none d-md-block">
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a href="#" class="nav-link">Página Inicial</a>
        </li>
        <li><a href="#" class="nav-link">Sobre</a></li>
        <li><a href="#" class="nav-link">Contato</a></li>
      </ul>
      <div class="dropdown">
        <hr class="text-secondary" />
        <a
          href="#"
          class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
          data-bs-toggle="dropdown"
        >
          <img
            src="https://github.com/mdo.png"
            alt=""
            width="32"
            height="32"
            class="rounded-circle me-2"
          />
          <strong>Perfil</strong>
        </a>
        <ul class="dropdown-menu dropdown-menu-dark shadow">
          <li><a class="dropdown-item" href="#">Sair</a></li>
        </ul>
      </div>
    </div>

    <main class="content">
      
      <div class="container-fluid">
        <header class="mb-3 fw-bold fs-2">Bem vindo ao OcorrenciasIF</header>
        <br>
        <div class="row">
    <div class="col-md-3">
        <div class="card bg-primary text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">Ocorrências Totais</h5>
                <p class="card-text fs-2">{{ total_cadastradas }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card bg-secondary text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">Pendentes</h5>
                <p class="card-text fs-2">{{ total_pendentes }}</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-dark mb-3">
            <div class="card-body">
                <h5 class="card-title">Em Andamento</h5>
                <p class="card-text fs-2">{{ total_andamento }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card bg-success text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">Resolvidas</h5>
                <p class="card-text fs-2">{{ total_resolvidas }}</p>
            </div>
        </div>
    </div>
</div>
        
        <br>
        <header class="mb-3">
          <h2 class="h4 fw-bold">Lista de Ocorrências</h2>
        </header>
        <button
          type="button"
          class="btn btn-dark mb-4"
          data-bs-toggle="modal"
          data-bs-target="#exampleModal"
        >
          + Nova Ocorrência
        </button>

       <div class="card shadow-sm border-0">
    <div class="table-responsive">
        <table class="table align-middle mb-0 custom-table" >
            <thead>
                <tr>
                    <th>Descrição</th>
                    <th>Status</th>
                    <th>Local</th>
                    <th class="text-center">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for ocorrencia in object_list %}
                <tr>
                    <td>{{ ocorrencia.descricao }}</td>
                    <td>
                        {% if ocorrencia.status == 'andamento' %}
                            <span class="badge bg-warning text-dark">Em Andamento</span>
                        {% elif ocorrencia.status == 'resolvida' %}
                            <span class="badge bg-success">Resolvida</span>
                        {% else %}
                            <span class="badge bg-secondary">Pendente</span>
                        {% endif %}
                    </td>
                    <td>{{ ocorrencia.local }}</td>
                    <td class="text-center">
                        <button onclick="abrirModal('{% url 'core:update' ocorrencia.id %}')" class="btn btn-link text-primary p-1" title="Editar">
                            <i class="bi bi-pencil-square fs-5"></i>
                        </button>
                        <button onclick="abrirModal('{% url 'core:delete' ocorrencia.id %}')" class="btn btn-link text-danger p-1" title="Excluir">
                            <i class="bi bi-trash fs-5"></i>
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center py-4 text-muted">Nenhuma ocorrência encontrada.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
    </main>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title">Nova Ocorrência</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">{% bootstrap_form form %}</div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modalPrincipal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog border-0">
        <div class="modal-content shadow-lg" id="conteudoDinamico"></div>
      </div>
    </div>

    {% bootstrap_javascript %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      async function abrirModal(url) {
        const resposta = await fetch(url, {
          headers: { "X-Requested-With": "XMLHttpRequest" },
        });
        const html = await resposta.text();
        document.getElementById("conteudoDinamico").innerHTML = html;
        new bootstrap.Modal(document.getElementById("modalPrincipal")).show();
      }
    </script>
  </body>
</html>
